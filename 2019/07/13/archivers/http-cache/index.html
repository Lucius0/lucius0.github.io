<!doctype html>




<html class="theme-next mist" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7371507374872885",
    enable_page_level_ads: true
  });
</script>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="http," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="在阅读该文章之前，建议对 HTTP 有所了解，可以看HTTP 入门体检，会对以下的内容有所帮助。 介绍 重用已获取的资源能够有效的提升网站与应用的性能。Web 缓存能够减少延迟与网络阻塞，进而减少显示某个资源所用的时间。借助 HTTP 缓存，Web 站点变得更具有响应性。  基本流程  浏览器发起请求(携带 Cache-Control )，会先去本地缓存看看是否有缓存并且命中，假如有就直接返回缓存">
<meta name="keywords" content="http">
<meta property="og:type" content="article">
<meta property="og:title" content="来杯一点点 - HTTP 缓存">
<meta property="og:url" content="https://lucius0.github.io/2019/07/13//archivers/http-cache/index.html">
<meta property="og:site_name" content="Lucius&#39;s Blog">
<meta property="og:description" content="在阅读该文章之前，建议对 HTTP 有所了解，可以看HTTP 入门体检，会对以下的内容有所帮助。 介绍 重用已获取的资源能够有效的提升网站与应用的性能。Web 缓存能够减少延迟与网络阻塞，进而减少显示某个资源所用的时间。借助 HTTP 缓存，Web 站点变得更具有响应性。  基本流程  浏览器发起请求(携带 Cache-Control )，会先去本地缓存看看是否有缓存并且命中，假如有就直接返回缓存">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://lucius0.github.io/images/http/cache-01.png">
<meta property="og:image" content="https://lucius0.github.io/images/http/cache-01.gif">
<meta property="og:image" content="https://lucius0.github.io/images/http/cache-02.png">
<meta property="og:image" content="https://lucius0.github.io/images/http/cache-02.gif">
<meta property="og:image" content="https://lucius0.github.io/images/http/cache-03.gif">
<meta property="og:image" content="https://lucius0.github.io/images/http/cache-04.gif">
<meta property="og:image" content="https://lucius0.github.io/images/http/cache-03.png">
<meta property="og:updated_time" content="2019-07-13T14:28:02.908Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="来杯一点点 - HTTP 缓存">
<meta name="twitter:description" content="在阅读该文章之前，建议对 HTTP 有所了解，可以看HTTP 入门体检，会对以下的内容有所帮助。 介绍 重用已获取的资源能够有效的提升网站与应用的性能。Web 缓存能够减少延迟与网络阻塞，进而减少显示某个资源所用的时间。借助 HTTP 缓存，Web 站点变得更具有响应性。  基本流程  浏览器发起请求(携带 Cache-Control )，会先去本地缓存看看是否有缓存并且命中，假如有就直接返回缓存">
<meta name="twitter:image" content="https://lucius0.github.io/images/http/cache-01.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://lucius0.github.io/2019/07/13//archivers/http-cache/"/>





  <title> 来杯一点点 - HTTP 缓存 | Lucius's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-143360785-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lucius's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            日志
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://lucius0.github.io/2019/07/13/archivers/http-cache/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Lucius">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Lucius's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Lucius's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                来杯一点点 - HTTP 缓存
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-13T00:00:00+08:00">
                2019-07-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/http/" itemprop="url" rel="index">
                    <span itemprop="name">http</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在阅读该文章之前，建议对 HTTP 有所了解，可以看<a href="https://lucius0.github.io/2019/06/30/archivers/http-introduction/">HTTP 入门体检</a>，会对以下的内容有所帮助。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>重用已获取的资源能够有效的提升网站与应用的性能。Web 缓存能够<strong>减少延迟</strong>与<strong>网络阻塞</strong>，进而减少显示某个资源所用的时间。借助 HTTP 缓存，Web 站点变得更具有响应性。</p>
</blockquote>
<h3 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h3><p><img src="/images/http/cache-01.png" alt=""></p>
<ol>
<li>浏览器发起请求(携带 <code>Cache-Control</code> )，会先去本地缓存看看是否有缓存并且命中，假如有就直接返回缓存资源，反之则就转向代理服务器；</li>
<li>代理服务器去查找相关的缓存设置，如<code>s-maxage</code>，以及该资源是否有缓存，同样的会去检查是否命中缓存资源，假如有则会返回至本地缓存，反之则到达源服务器；</li>
<li>到达源服务器后，源服务器会返回资源新文件，然后一步步返回。</li>
</ol>
<p>这大概就是缓存最粗糙的一个基本流程，接下来我们来一步步的浅析缓存的原理。</p>
<h2 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h2><p>在 <a href="https://lucius0.github.io/2019/06/30/archivers/http-introduction/">网络协议入门体检</a> 中我们已经列举了关于 Cache-Control 的缓存指令，由于缓存的篇幅有点多，就不在堆积成一篇来讲解。</p>
<h3 id="缓存请求指令"><a href="#缓存请求指令" class="headerlink" title="缓存请求指令"></a>缓存请求指令</h3><table>
<thead>
<tr>
<th style="text-align:center">常见缓存请求指令</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">no-cache</td>
<td style="text-align:center">强制向服务器再次验证</td>
</tr>
<tr>
<td style="text-align:center">no-store</td>
<td style="text-align:center">不缓存请求或响应的任何内容</td>
</tr>
<tr>
<td style="text-align:center">max-age=(秒)</td>
<td style="text-align:center">响应的最大 Age 值</td>
</tr>
<tr>
<td style="text-align:center">max-stale=[秒]</td>
<td style="text-align:center">接收已过期的响应</td>
</tr>
<tr>
<td style="text-align:center">min-fresh=(秒)</td>
<td style="text-align:center">期望在指定时间内的响应仍有效</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center">常见缓存响应指令</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">public</td>
<td style="text-align:center">可向任意方提供响应的缓存</td>
</tr>
<tr>
<td style="text-align:center">private</td>
<td style="text-align:center">仅向特定用户返回响应</td>
</tr>
<tr>
<td style="text-align:center">no-cache</td>
<td style="text-align:center">缓存前必须先确认其有效性</td>
</tr>
<tr>
<td style="text-align:center">no-store</td>
<td style="text-align:center">不缓存请求或响应的任何内容</td>
</tr>
<tr>
<td style="text-align:center">max-age=(秒)</td>
<td style="text-align:center">响应的最大 Age 值</td>
</tr>
<tr>
<td style="text-align:center">s-maxage=(秒)</td>
<td style="text-align:center">公共缓存服务器响应的最大 Age 值</td>
</tr>
<tr>
<td style="text-align:center">must-revalidate</td>
<td style="text-align:center">可缓存但必须再向源服务器进行确认</td>
</tr>
</tbody>
</table>
<h2 id="Cache-Control-缓存特性"><a href="#Cache-Control-缓存特性" class="headerlink" title="Cache-Control 缓存特性"></a>Cache-Control 缓存特性</h2><p>我们一开始开到表格估计会吓一跳，仅仅只是一个 <code>Cache-Control</code> 就几乎有那么多指令。但实际上我们把它分为特性模块来看，我们自然而然就会清晰很多。</p>
<h3 id="可缓存性"><a href="#可缓存性" class="headerlink" title="可缓存性"></a>可缓存性</h3><ul>
<li>public：就是该 HTTP 请求所请求的内容，无论是经过<strong>代理服务器</strong>还是客户端，都可以对该请求进行缓存操作；</li>
<li>private：只有发起请求的浏览器才可以进行缓存，而<strong>代理服务器</strong>则不可以；</li>
<li>no-cache：这里的意思是可以缓存，但是在缓存之前不管过没过期，都需要向源服务器进行资源有效性校验；</li>
</ul>
<h3 id="过期性"><a href="#过期性" class="headerlink" title="过期性"></a>过期性</h3><ul>
<li>max-age：该缓存什么时候到期；</li>
<li>s-maxage：在<strong>代理服务器</strong>中，如果我们同时设置了 <code>max-age</code> 以及 <code>s-maxage</code>，那么<strong>代理服务器</strong>会读取 <code>s-maxage</code>，因为该指令是专门为代理服务器而存在的；</li>
</ul>
<h3 id="重新验证"><a href="#重新验证" class="headerlink" title="重新验证"></a>重新验证</h3><ul>
<li>must-revalidate：假如还没到过期时间，那么可以使用缓存资源；反之就必须到源服务器进行有效检验；</li>
<li>proxy-revalidate：同 <code>must-revalidate</code>，只是 <code>proxy-revalidate</code> 用在缓存服务器；</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li>no-store：看起来跟 <code>no-cache</code> 一样，实际上 <code>no-store</code> 则是表示彻底的不可以使用缓存，也就是说每次请求都是最新的资源；</li>
<li>no-transform：主要是针对<strong>代理服务器</strong>的，有些<strong>代理服务器</strong>会将源资源进行一些二次处理，例如压缩，转格式等操作，<code>no-transform</code> 指令是指明了<strong>代理服务器</strong>不允许对资源进行二次处理；</li>
<li>…：剩余的指令表示其他的几乎很少见到，在这里就不在多说，之后有遇到场景再回来补充。</li>
</ul>
<h2 id="Cache-Control-实战模拟"><a href="#Cache-Control-实战模拟" class="headerlink" title="Cache-Control 实战模拟"></a>Cache-Control 实战模拟</h2><p>我们开始来通过实战模拟一下有关 <code>Cache-Control</code> 的指令对缓存的作用。Koa2，启动。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> readFile = util.promisify(fs.readFile);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> url = ctx.request.url;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (url.includes(<span class="string">'.jpg'</span>)) &#123;</span><br><span class="line">    <span class="keyword">const</span> img = <span class="keyword">await</span> readFile(path.resolve(__dirname, <span class="string">`.<span class="subst">$&#123;url&#125;</span>`</span>));</span><br><span class="line">    ctx.body = img;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> html = <span class="keyword">await</span> readFile(path.resolve(__dirname, <span class="string">`./index.html`</span>));</span><br><span class="line">    ctx.status = <span class="number">200</span>;</span><br><span class="line">    ctx.set(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>);</span><br><span class="line">    ctx.res.end(html);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>执行完毕，我们可以看到无论我们怎么刷新页面，图片的 Size 依旧是那个 Size，不增不减，说明并没有缓存。</p>
<p><img src="/images/http/cache-01.gif" alt=""></p>
<p>我们在输出图片之前，设置缓存指令<code>max-age=5</code>，表示缓存时间5s。这样我们就可以很好的观察它的开始缓存以及结束缓存之后的表现。<strong>记得关闭 Chrome 浏览器的 Disable Cache。</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.set(<span class="string">'Cache-Control'</span>, <span class="string">'max-age=5'</span>);</span><br></pre></td></tr></table></figure></p>
<p>对应的响应报文如下，可以看到我们已经成功的设置了 <code>Cache-Control</code> 报文指令。</p>
<p><img src="/images/http/cache-02.png" alt=""></p>
<p>在下图可以看到，中间的5s都是内存缓存读取的资源，耗时0ms，前后分别是开始拉取资源以及缓存时间过期。</p>
<p><img src="/images/http/cache-02.gif" alt=""></p>
<p>此时，假如我们<strong>在缓存期间修改了资源内容，但是路径名不变</strong>，那么读取的资源是新资源呢还是缓存资源呢？答案是缓存资源，因为一旦设置了 <code>Cache-Control</code> 并且在客户端缓存了，那么再起请求假如还在缓存期间，那么就不会再向服务器发送请求了。</p>
<h2 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h2><p>除了 <code>Cache-Control</code> 可以控制资源的缓存状态之外，还有<code>Expires</code>，它是 HTTP 1.0 的产物，但是还是有很多地方会有到它。它跟 <code>Cache-Control</code> 中的 <code>max-age</code> 有什么区别呢？</p>
<ul>
<li>表达方式：<code>Expires</code> 是绝对时间，如 <code>Expires: Tue Jul 09 2019 23:13:28 GMT+0800</code>，而 <code>max-age</code> 是相对时间，如<code>max-age=3600</code>；</li>
<li>协议版本：<code>Expires</code> 是 HTTP 1.0 版本的首部字段，而 <code>max-age</code> 是 HTTP  1.1 版本及其之后的首部字段；</li>
<li>优先级：当请求协议版本为 HTTP 1.0 时，同时存在 <code>Expires</code> 和 <code>max-age</code> 会<strong>无视</strong> <code>max-age</code>，而当请求协议版本为 HTTP 1.1 则会<strong>优先处理</strong> <code>max-age</code> 指令；</li>
</ul>
<p>除此之外，它们的使用方法时一样的，因此我们就不再实战演示了，它们都是用来校验<strong>强缓存</strong>的标识。</p>
<h2 id="缓存校验-Last-Modified-amp-ETag"><a href="#缓存校验-Last-Modified-amp-ETag" class="headerlink" title="缓存校验 Last-Modified &amp; ETag"></a>缓存校验 Last-Modified &amp; ETag</h2><h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>顾名思义，上次修改时间。主要配合 <code>If-Modified-Since</code> 或者 <code>If-Unmodified-Sice</code>。</p>
<p>基本流程：</p>
<ol>
<li>首次请求资源，服务器返回资源时带上实体首部字段<code>Last-Modified</code>；</li>
<li>当我们再次请求该资源时，浏览器会自动在请求头带上首部字段<code>If-Modified-Since</code>，此时的 <code>If-Modified-Since</code> 等于 <code>Last-Modified</code> ；</li>
<li>服务器接收到请求后，会根据 <code>If-Modified-Since</code> 配合 <code>Last-Modified</code>来判断资源在该日期之后是否发生过变化；</li>
<li>如果发生修改了，则返回新的资源并返回新的 <code>Last-Modified</code>，反之则返回状态码304 <code>Not Modified</code>，这个过程称为<strong>协商缓存</strong>。</li>
</ol>
<h3 id="ETag"><a href="#ETag" class="headerlink" title="ETag"></a>ETag</h3><p>相对于 <code>Last-Modified</code>，<code>ETag</code> 是一个更加严格的验证，它主要是通过数字签名表示资源的<strong>唯一性</strong>，但当该资源发生修改，那么该签名也会随之变化，但是无论如何都会保证它的<strong>唯一性</strong>。所以根据它的<strong>唯一性</strong>，就可以 <code>If-Match</code> 或者 <code>If-Non-Match</code> 知道资源有没有发生修改。</p>
<p>基础流程：<br>同 <code>Last-Modified</code>，只是把 <code>Last-Modified</code> 换成 <code>ETag</code>， <code>If-Modified-Since</code> 换成 <code>If-Match</code> 。但是假如 <code>Last-Modified</code> 以及 <code>ETag</code> 同时存在，则后者<code>ETag</code> 的优先级比较高。</p>
<h2 id="强缓存-amp-协商缓存"><a href="#强缓存-amp-协商缓存" class="headerlink" title="强缓存 &amp; 协商缓存"></a>强缓存 &amp; 协商缓存</h2><p>在进行最后一个实战模拟之前，要先说下这两个十分重要的概念：<strong>强缓存</strong>以及<strong>协商缓存</strong>。</p>
<h3 id="强缓存"><a href="#强缓存" class="headerlink" title="强缓存"></a>强缓存</h3><p>简单粗暴来讲，就是<strong>客户端知道资源过期时间后，由客户端来决定要不要缓存。</strong>那么怎么知道资源的过期时间呢？由谁来决定它们的过期时间呢？就是由我们上文提到的 <code>Expires</code> 以及 <code>Cache-Control: max-age</code>。</p>
<h3 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h3><p>跟<strong>强缓存</strong>相反，是由<strong>服务器来决定客户端要不要使用缓存</strong>。在有 <code>ETag</code> 以及 <code>Last-Modified</code> 响应首部字段的情况下，客户端会向服务器发起资源的缓存校验，然后服务器会告知客户端是使用缓存(304)还是返回一个全新的资源，表面上看都是会发起一个请求，但是响应的时候则是不是一个完整的响应则看是否需要缓存。</p>
<p>还记得<code>Cache-Control</code>的指令<code>no-cache</code>和<code>no-store</code>吗？这时候应该就清楚了两者的区别了。<code>no-cache</code> 就是直接跳过<strong>强缓存</strong>进入<strong>协商缓存</strong>。而 <code>no-store</code> 则是<strong>不缓存</strong>，效果等同于 Chrome 浏览器的 Disable Cache，仔细观察，你会发现请求首部字段是不会携带关于缓存的任何首部字段。</p>
<h2 id="Last-Modified-实战模拟"><a href="#Last-Modified-实战模拟" class="headerlink" title="Last-Modified 实战模拟"></a>Last-Modified 实战模拟</h2><p>我们在上面 <code>max-age: 5</code> 的基础上添加 <code>no-cache</code>，可以看到我们无论如何刷新，都是一个新的资源(<strong>我们还没设置协商缓存的相关字段</strong>)。</p>
<p><img src="/images/http/cache-03.gif" alt=""></p>
<p>在这里我们只做 <code>Last-Modified</code> 的实战模拟，因为 <code>ETag</code> 同理。代码较上面没多大变化，我只贴变化的代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> readStat = util.promisify(fs.stat);</span><br><span class="line"><span class="comment">// ... 没变化</span></span><br><span class="line"><span class="keyword">const</span> imageUrl = path.resolve(__dirname, <span class="string">`.<span class="subst">$&#123;url&#125;</span>`</span>);</span><br><span class="line"><span class="keyword">const</span> imageStat = <span class="keyword">await</span> readStat(imageUrl);</span><br><span class="line"><span class="keyword">const</span> lastModified = imageStat.mtime.toUTCString();</span><br><span class="line"><span class="keyword">const</span> ifModifiedSince = ctx.headers[<span class="string">'if-modified-since'</span>];</span><br><span class="line"></span><br><span class="line">ctx.set(<span class="string">'Cache-Control'</span>, <span class="string">'max-age=5, no-cache'</span>);</span><br><span class="line">ctx.set(<span class="string">'Last-Modified'</span>, lastModified);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (ifModifiedSince === lastModified) &#123;</span><br><span class="line">  ctx.status = <span class="number">304</span>;</span><br><span class="line">  ctx.res.end();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> imageBuffer = <span class="keyword">await</span> readFile(imageUrl);</span><br><span class="line">  ctx.body = imageBuffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，第一次请求的时候，服务器携带响应首部字段<code>Last-Modified</code>，这时候的返回来的<strong>报文主体大小: 104KB</strong>。之后第二次请求时浏览器自动携带请求首部字段<code>If-Modified-Since</code>，响应返回来的<strong>报文主体大小: 172B</strong></p>
<p><img src="/images/http/cache-04.gif" alt=""></p>
<p><strong>注：</strong></p>
<blockquote>
<p>koa2 有自己的一套处理协商缓存的属性，即<code>request.fresh</code>，有兴趣自行了解。</p>
</blockquote>
<h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><p><img src="/images/http/cache-03.png" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我想，这下子总算知道为什么有时候 Chrome 浏览器会展示<code>disk cache/memory cache</code>了吧，它跟304 <code>Not Modified</code> 同样都是被缓存的意思，这是方式不一样。由此可见，合理的使用缓存是多么的重要，它可以使我们<strong>减少无所谓的请求</strong>、<strong>避免资源文件的重复传输</strong>、<strong>减少对源服务器的资源占用</strong>等等好处，但也不能滥用。</p>
<h2 id="彩蛋"><a href="#彩蛋" class="headerlink" title="彩蛋"></a>彩蛋</h2><p>我们熟悉了浏览器的调试方式，但是不同的操作都是有不一样的效果。注意到上图的①、②没有？它是这个彩蛋准备的。</p>
<ul>
<li>输入地址回车：流程从①开始走起；</li>
<li>刷新：Cmd+R (Mac) / Ctrl + R (Window) 。流程从 ② 走起，也就是跳过<strong>强缓存</strong>校验直接到<strong>协商缓存</strong>。<strong>注意</strong>，重新输入当前地址回车也是走这一步，这说明只有第一次输入地址回车才是从①开始；</li>
<li>强制刷新：Cmd + Shift + R (Mac) / Ctrl + Shift + R (Window)。不带条件直接访问服务器的文件；</li>
<li>BF Cache (Backward/Forward Cache)：指的是浏览器前进/后退。在这里既不是①也不是②。它是使用了更强的缓存策略，表现为DOM，window，甚至JavaScript对象被缓存，以及同步XHR被缓存。而且这是浏览器自己的行为，与HTTP无关，因此在不同浏览器有不同的表现，这就是为什么有时候 <code>setTimeout</code> 计时不可靠的原因了。</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.cnblogs.com/chenqf/p/6386163.html" target="_blank" rel="noopener">彻底弄懂HTTP缓存机制及原理</a></li>
<li><a href="https://github.com/rccoder/blog/issues/12" target="_blank" rel="noopener">说说浏览器端缓存的那点事儿</a></li>
<li><a href="http://imweb.io/topic/5795dcb6fb312541492eda8c" target="_blank" rel="noopener">HTTP缓存控制小结</a></li>
<li><a href="https://harttle.land/2017/03/12/backward-forward-cache.html" target="_blank" rel="noopener">浏览器前进/后退缓存（BF Cache）</a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>我只是试下能不能被赞赏😳</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="https://bbucket-1257297990.cos.ap-guangzhou.myqcloud.com/IMG_4838.jpg" alt="Lucius WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="https://bbucket-1257297990.cos.ap-guangzhou.myqcloud.com/171226222918.png" alt="Lucius Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>    
     
     
        <ul class="post-copyright">
          <li class="post-copyright-author">
              <strong>本文作者：</strong>Lucius
          </li>
          <li class="post-copyright-link">
            <strong>本文链接：</strong>
            <a href="/2019/07/13/archivers/http-cache/" title="来杯一点点 - HTTP 缓存">2019/07/13//archivers/http-cache/</a>
          </li>
          <li class="post-copyright-license">
            <strong>版权声明： </strong>
            本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处！
          </li>
        </ul>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-7371507374872885"
     data-ad-slot="4569151502"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      
    </div>
    
    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/http/" rel="tag"># http</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/01/archivers/web-secure-csrf/" rel="next" title="Web 安全防御战 - 浅谈CSRF">
                <i class="fa fa-chevron-left"></i> Web 安全防御战 - 浅谈CSRF
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/21/archivers/http-cookie/" rel="prev" title="来一块饼干吗？ - HTTP Cookie">
                来一块饼干吗？ - HTTP Cookie <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="gitalk-container"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Lucius" />
          <p class="site-author-name" itemprop="name">Lucius</p>
          <p class="site-description motion-element" itemprop="description">stay hungry, stay foolish...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">59</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Lucius0" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#介绍"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本流程"><span class="nav-number">1.1.</span> <span class="nav-text">基本流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cache-Control"><span class="nav-number">2.</span> <span class="nav-text">Cache-Control</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存请求指令"><span class="nav-number">2.1.</span> <span class="nav-text">缓存请求指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cache-Control-缓存特性"><span class="nav-number">3.</span> <span class="nav-text">Cache-Control 缓存特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#可缓存性"><span class="nav-number">3.1.</span> <span class="nav-text">可缓存性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#过期性"><span class="nav-number">3.2.</span> <span class="nav-text">过期性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重新验证"><span class="nav-number">3.3.</span> <span class="nav-text">重新验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他"><span class="nav-number">3.4.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cache-Control-实战模拟"><span class="nav-number">4.</span> <span class="nav-text">Cache-Control 实战模拟</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Expires"><span class="nav-number">5.</span> <span class="nav-text">Expires</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存校验-Last-Modified-amp-ETag"><span class="nav-number">6.</span> <span class="nav-text">缓存校验 Last-Modified &amp; ETag</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Last-Modified"><span class="nav-number">6.1.</span> <span class="nav-text">Last-Modified</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ETag"><span class="nav-number">6.2.</span> <span class="nav-text">ETag</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#强缓存-amp-协商缓存"><span class="nav-number">7.</span> <span class="nav-text">强缓存 &amp; 协商缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#强缓存"><span class="nav-number">7.1.</span> <span class="nav-text">强缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#协商缓存"><span class="nav-number">7.2.</span> <span class="nav-text">协商缓存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Last-Modified-实战模拟"><span class="nav-number">8.</span> <span class="nav-text">Last-Modified 实战模拟</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#流程图"><span class="nav-number">9.</span> <span class="nav-text">流程图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">10.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#彩蛋"><span class="nav-number">11.</span> <span class="nav-text">彩蛋</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">12.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lucius</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i> 访问人数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i> 总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: 'c35834931d268e5c17c6',
          clientSecret: 'c80a4f57c98a6cf8d87e0c7d306201814a0dc745',
          repo: 'lucius0.github.io',
          owner: 'lucius0',
          admin: ['lucius0'],
          id: location.pathname,
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')           
       </script>


  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


  <script type="text/javascript">
    (function() {
      // try {
      //   var document = window.document;
      //   document.oncontextmenu = function() {
      //     return false;
      //   }
      //   document.onkeydown = function() {
      //     if (window.event.ctrlKey && window.event.keyCode == 67) {
      //       return false;
      //     }
      //     return false;
      //   }
      //   document.body.oncopy = function() {
      //     return false;
      //   }
      //   document.onselectstart = function() {
      //     return false;
      //   }
            
      //   document.onselectstart=function(){return false};
      //   // document.style.MozUserSelect && document.style.MozUserSelect="none";
      //   document.onmousedown=function(){return false};
      //   document.style.cursor = "default"; 
      // } catch(e) {}
    })();
  </script>

</body>
</html>
